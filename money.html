<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Money Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2c3e50;
        }
        
        body.dark-mode {
            background: linear-gradient(135deg, #232526 0%, #414345 100%);
            color: #ecf0f1;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        body.dark-mode header {
            background: #2c3e50;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        body.dark-mode h1 {
            color: #ecf0f1;
        }
        
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #2c3e50;
        }
        
        body.dark-mode .theme-toggle {
            color: #ecf0f1;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            display: flex;
            flex-direction: column;
        }
        
        body.dark-mode .card {
            background: #2c3e50;
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        body.dark-mode .card h3 {
            color: #ecf0f1;
        }
        
        .card .amount {
            font-size: 24px;
            font-weight: bold;
            margin-top: auto;
        }
        
        .card.income .amount {
            color: #27ae60;
        }
        
        .card.expense .amount {
            color: #e74c3c;
        }
        
        .card.balance .amount {
            color: #3498db;
        }
        
        .card.savings .amount {
            color: #9b59b6;
        }
        
        .tracker-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 1100px) {
            .tracker-container {
                grid-template-columns: 1fr;
            }
        }
        
        .form-section, .data-section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .form-section, 
        body.dark-mode .data-section {
            background: #2c3e50;
        }
        
        .form-section h2, .data-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f1f1f1;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        body.dark-mode .form-section h2, 
        body.dark-mode .data-section h2 {
            color: #ecf0f1;
            border-bottom: 2px solid #34495e;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        body.dark-mode label {
            color: #ecf0f1;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            background: white;
            color: #2c3e50;
        }
        
        body.dark-mode input, 
        body.dark-mode select {
            background: #34495e;
            border-color: #2c3e50;
            color: #ecf0f1;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .export-btn {
            background: #27ae60;
            margin-top: 15px;
        }
        
        .export-btn:hover {
            background: #219653;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        body.dark-mode th, 
        body.dark-mode td {
            border-bottom: 1px solid #34495e;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }
        
        body.dark-mode th {
            background-color: #34495e;
            color: #ecf0f1;
        }
        
        tr:hover {
            background-color: #f8f9fa;
        }
        
        body.dark-mode tr:hover {
            background-color: #34495e;
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .actions button {
            padding: 8px 12px;
            font-size: 14px;
        }
        
        .delete-btn {
            background: #e74c3c;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
        
        .chart-container {
            margin-top: 30px;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .chart-container {
            background: #2c3e50;
        }
        
        .chart-wrapper {
            width: 60%;
            margin: 0 auto;
        }
        
        .chart-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .chart-type-btn {
            background: #95a5a6;
            padding: 8px 15px;
            font-size: 14px;
        }
        
        .chart-type-btn.active {
            background: #3498db;
        }
        
        .expense-distribution {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .distribution-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .distribution-card {
            background: #2c3e50;
        }
        
        .distribution-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        body.dark-mode .distribution-card h3 {
            color: #ecf0f1;
        }
        
        .distribution-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f1f1f1;
        }
        
        body.dark-mode .distribution-item {
            border-bottom: 1px solid #34495e;
        }
        
        .distribution-item:last-child {
            border-bottom: none;
        }
        
        .category {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .category-color {
            width: 15px;
            height: 15px;
            border-radius: 50%;
        }
        
        .salary-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        body.dark-mode .salary-section {
            background: #2c3e50;
        }
        
        .salary-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }
        
        @media (max-width: 768px) {
            .salary-form {
                grid-template-columns: 1fr;
            }
            .chart-wrapper {
                width: 100%;
            }
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .tabs {
            background: #2c3e50;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
            font-weight: 600;
        }
        
        body.dark-mode .tab {
            color: #ecf0f1;
        }
        
        .tab.active {
            background: #3498db;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .savings-goal {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        body.dark-mode .savings-goal {
            background: #34495e;
        }
        
        .progress-bar {
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        body.dark-mode .progress-bar {
            background: #34495e;
        }
        
        .progress {
            height: 100%;
            background: #9b59b6;
            border-radius: 10px;
            text-align: center;
            color: white;
            font-size: 12px;
            line-height: 20px;
        }
        
        .savings-chart-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        @media (max-width: 900px) {
            .savings-chart-container {
                grid-template-columns: 1fr;
            }
        }
        
        .savings-timeline {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-mode .savings-timeline {
            background: #2c3e50;
        }
        
        .timeline-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f1f1f1;
        }
        
        body.dark-mode .timeline-item {
            border-bottom: 1px solid #34495e;
        }
        
        .timeline-item:last-child {
            border-bottom: none;
        }
        
        .positive {
            color: #27ae60;
        }
        
        .negative {
            color: #e74c3c;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-money-bill-wave"></i> Personal Money Tracker</h1>
            <p>Track your income, expenses, and savings in one place</p>
            <button class="theme-toggle" id="theme-toggle">
                <i class="fas fa-moon"></i>
            </button>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="dashboard">Dashboard</div>
            <div class="tab" data-tab="expenses">Expenses</div>
            <div class="tab" data-tab="savings">Savings</div>
        </div>
        
        <div class="tab-content active" id="dashboard-tab">
            <div class="salary-section">
                <h2><i class="fas fa-wallet"></i> Monthly Salary</h2>
                <form id="salary-form" class="salary-form">
                    <div class="form-group">
                        <label for="salary-month">Month</label>
                        <select id="salary-month" required>
                            <option value="">Select Month</option>
                            <option value="January">January</option>
                            <option value="February">February</option>
                            <option value="March">March</option>
                            <option value="April">April</option>
                            <option value="May">May</option>
                            <option value="June">June</option>
                            <option value="July">July</option>
                            <option value="August">August</option>
                            <option value="September">September</option>
                            <option value="October">October</option>
                            <option value="November">November</option>
                            <option value="December">December</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="salary-amount">Salary Amount (₹)</label>
                        <input type="number" id="salary-amount" required placeholder="Enter your salary">
                    </div>
                    <div class="form-group">
                        <button type="submit">Add Salary <i class="fas fa-plus-circle"></i></button>
                    </div>
                </form>
                <button class="export-btn" id="export-salary-btn">
                    <i class="fas fa-download"></i> Export Salary Data
                </button>
            </div>
            
            <div class="summary-cards">
                <div class="card income">
                    <h3><i class="fas fa-money-bill-wave"></i> Total Income</h3>
                    <div class="amount">₹0.00</div>
                </div>
                <div class="card expense">
                    <h3><i class="fas fa-shop"></i> Total Expenses</h3>
                    <div class="amount">₹0.00</div>
                </div>
                <div class="card balance">
                    <h3><i class="fas fa-coins"></i> Balance</h3>
                    <div class="amount">₹0.00</div>
                </div>
                <div class="card savings">
                    <h3><i class="fas fa-piggy-bank"></i> Savings</h3>
                    <div class="amount">₹0.00</div>
                </div>
            </div>
            
            <div class="chart-container">
                <h2><i class="fas fa-chart-pie"></i> Expense Distribution</h2>
                <div class="chart-controls">
                    <button class="chart-type-btn active" data-chart-type="pie">Pie Chart</button>
                    <button class="chart-type-btn" data-chart-type="bar">Bar Chart</button>
                    <button class="chart-type-btn" data-chart-type="doughnut">Doughnut Chart</button>
                </div>
                <div class="chart-wrapper">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
            
            <div class="expense-distribution">
                <div class="distribution-card">
                    <h3><i class="fas fa-list"></i> Category Breakdown</h3>
                    <div id="category-breakdown">
                        <!-- Category items will be inserted here dynamically -->
                    </div>
                </div>
                <div class="distribution-card">
                    <h3><i class="fas fa-history"></i> Recent Expenses</h3>
                    <div id="recent-expenses">
                        <!-- Recent expenses will be inserted here dynamically -->
                    </div>
                </div>
                <div class="distribution-card">
                    <h3><i class="fas fa-bullseye"></i> Savings Goal</h3>
                    <p>Set a monthly savings goal to track your progress:</p>
                    <div class="form-group">
                        <input type="number" id="savings-goal" placeholder="Savings goal amount (₹)">
                    </div>
                    <button id="set-goal-btn">Set Goal <i class="fas fa-target"></i></button>
                    <div id="goal-progress" class="savings-goal">
                        <div class="progress-bar">
                            <div class="progress" style="width: 0%">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="expenses-tab">
            <div class="tracker-container">
                <div class="form-section">
                    <h2><i class="fas fa-plus"></i> Add New Expense</h2>
                    <form id="expense-form">
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input type="date" id="date" required>
                        </div>
                        <div class="form-group">
                            <label for="day">Day</label>
                            <select id="day" required>
                                <option value="">Select Day</option>
                                <option value="Monday">Monday</option>
                                <option value="Tuesday">Tuesday</option>
                                <option value="Wednesday">Wednesday</option>
                                <option value="Thursday">Thursday</option>
                                <option value="Friday">Friday</option>
                                <option value="Saturday">Saturday</option>
                                <option value="Sunday">Sunday</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="emi">EMI (₹)</label>
                            <input type="number" id="emi" step="0.01" placeholder="Enter EMI amount">
                        </div>
                        <div class="form-group">
                            <label for="recharge">Recharge (₹)</label>
                            <input type="number" id="recharge" step="0.01" placeholder="Enter recharge amount">
                        </div>
                        <div class="form-group">
                            <label for="travel">Travel (₹)</label>
                            <input type="number" id="travel" step="0.01" placeholder="Enter travel expense">
                        </div>
                        <div class="form-group">
                            <label for="food">Food (₹)</label>
                            <input type="number" id="food" step="0.01" placeholder="Enter food expense">
                        </div>
                        <div class="form-group">
                            <label for="health">Personal Health (₹)</label>
                            <input type="number" id="health" step="0.01" placeholder="Enter health expense">
                        </div>
                        <div class="form-group">
                            <label for="dress">Dress (₹)</label>
                            <input type="number" id="dress" step="0.01" placeholder="Enter dress expense">
                        </div>
                        <div class="form-group">
                            <label for="family">Family Expenses (₹)</label>
                            <input type="number" id="family" step="0.01" placeholder="Enter family expenses">
                        </div>
                        <button type="submit">Add Expense <i class="fas fa-plus-circle"></i></button>
                    </form>
                </div>
                
                <div class="data-section">
                    <h2><i class="fas fa-history"></i> Expense History</h2>
                    <button class="export-btn" id="export-expense-btn">
                        <i class="fas fa-download"></i> Export Expense Data
                    </button>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Day</th>
                                    <th>EMI</th>
                                    <th>Recharge</th>
                                    <th>Travel</th>
                                    <th>Food</th>
                                    <th>Health</th>
                                    <th>Dress</th>
                                    <th>Family</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expense-table-body">
                                <!-- Data will be inserted here dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="savings-tab">
            <div class="chart-container">
                <h2><i class="fas fa-chart-line"></i> Savings Progress</h2>
                <div class="chart-wrapper">
                    <canvas id="savingsChart"></canvas>
                </div>
            </div>
            
            <div class="savings-chart-container">
                <div class="savings-timeline">
                    <h3><i class="fas fa-history"></i> Savings Timeline</h3>
                    <div id="savings-timeline">
                        <!-- Savings timeline will be inserted here dynamically -->
                    </div>
                </div>
                
                <div class="distribution-card">
                    <h3><i class="fas fa-info-circle"></i> About Savings</h3>
                    <p>Your savings are calculated automatically by subtracting your total expenses from your salary.</p>
                    <p>Set a savings goal to track your progress each month. The progress bar will show how close you are to reaching your goal.</p>
                    <div class="savings-goal">
                        <i class="fas fa-lightbulb"></i>
                        <span>Tip: Try to save at least 20% of your income each month</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set default date to today
            const today = new Date();
            const formattedDate = today.toISOString().substr(0, 10);
            document.getElementById('date').value = formattedDate;
            
            // Get day of week and set it automatically
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayOfWeek = days[today.getDay()];
            document.getElementById('day').value = dayOfWeek;
            
            // Set current month as default
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            document.getElementById('salary-month').value = months[today.getMonth()];
            
            // Initialize Chart.js with smaller pie chart
            const ctx = document.getElementById('expenseChart').getContext('2d');
            let expenseChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['EMI', 'Recharge', 'Travel', 'Food', 'Health', 'Dress', 'Family'],
                    datasets: [{
                        data: [0, 0, 0, 0, 0, 0, 0],
                        backgroundColor: [
                            '#FF6384',
                            '#36A2EB',
                            '#FFCE56',
                            '#4BC0C0',
                            '#9966FF',
                            '#FF9F40',
                            '#FF6384'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                boxWidth: 15,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Expense Distribution',
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
            
            // Initialize Savings Chart
            const savingsCtx = document.getElementById('savingsChart').getContext('2d');
            const savingsChart = new Chart(savingsCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Savings (₹)',
                        data: [],
                        backgroundColor: 'rgba(155, 89, 182, 0.2)',
                        borderColor: 'rgba(155, 89, 182, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(155, 89, 182, 1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Monthly Savings Trend'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Amount (₹)'
                            }
                        }
                    }
                }
            });
            
            // Store expenses and salary
            let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
            let salaryData = JSON.parse(localStorage.getItem('salaryData')) || {};
            let savingsGoal = JSON.parse(localStorage.getItem('savingsGoal')) || 0;
            
            // Set up tab navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs and contents
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    // Add active class to clicked tab and corresponding content
                    this.classList.add('active');
                    document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
                });
            });
            
            // Set savings goal
            document.getElementById('set-goal-btn').addEventListener('click', function() {
                savingsGoal = parseFloat(document.getElementById('savings-goal').value) || 0;
                localStorage.setItem('savingsGoal', JSON.stringify(savingsGoal));
                updateSavingsGoalProgress();
            });
            
            // Automatically set day when date changes
            document.getElementById('date').addEventListener('change', function() {
                const selectedDate = new Date(this.value);
                const dayIndex = selectedDate.getDay();
                document.getElementById('day').value = days[dayIndex];
            });
            
            // Add salary form submission
            document.getElementById('salary-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const month = document.getElementById('salary-month').value;
                const amount = parseFloat(document.getElementById('salary-amount').value);
                
                if (month && amount) {
                    salaryData[month] = amount;
                    localStorage.setItem('salaryData', JSON.stringify(salaryData));
                    updateSummary();
                    updateSavingsChart();
                    this.reset();
                    document.getElementById('salary-month').value = month;
                }
            });
            
            // Add expense form submission
            document.getElementById('expense-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const expense = {
                    date: document.getElementById('date').value,
                    day: document.getElementById('day').value,
                    emi: parseFloat(document.getElementById('emi').value) || 0,
                    recharge: parseFloat(document.getElementById('recharge').value) || 0,
                    travel: parseFloat(document.getElementById('travel').value) || 0,
                    food: parseFloat(document.getElementById('food').value) || 0,
                    health: parseFloat(document.getElementById('health').value) || 0,
                    dress: parseFloat(document.getElementById('dress').value) || 0,
                    family: parseFloat(document.getElementById('family').value) || 0
                };
                
                expenses.push(expense);
                saveExpenses();
                renderExpenses();
                updateChart();
                updateSummary();
                updateSavingsGoalProgress();
                this.reset();
                
                // Reset date and day to today
                document.getElementById('date').value = formattedDate;
                document.getElementById('day').value = dayOfWeek;
            });
            
            // Save expenses to localStorage
            function saveExpenses() {
                localStorage.setItem('expenses', JSON.stringify(expenses));
            }
            
            // Render expenses table
            function renderExpenses() {
                const tableBody = document.getElementById('expense-table-body');
                tableBody.innerHTML = '';
                
                expenses.forEach((expense, index) => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${expense.date}</td>
                        <td>${expense.day}</td>
                        <td>${expense.emi ? '₹' + expense.emi.toFixed(2) : '-'}</td>
                        <td>${expense.recharge ? '₹' + expense.recharge.toFixed(2) : '-'}</td>
                        <td>${expense.travel ? '₹' + expense.travel.toFixed(2) : '-'}</td>
                        <td>${expense.food ? '₹' + expense.food.toFixed(2) : '-'}</td>
                        <td>${expense.health ? '₹' + expense.health.toFixed(2) : '-'}</td>
                        <td>${expense.dress ? '₹' + expense.dress.toFixed(2) : '-'}</td>
                        <td>${expense.family ? '₹' + expense.family.toFixed(2) : '-'}</td>
                        <td class="actions">
                            <button class="delete-btn" data-index="${index}"><i class="fas fa-trash"></i></button>
                        </td>
                    `;
                    
                    tableBody.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        expenses.splice(index, 1);
                        saveExpenses();
                        renderExpenses();
                        updateChart();
                        updateSummary();
                        updateSavingsGoalProgress();
                    });
                });
            }
            
            // Update chart
            function updateChart() {
                const totals = {
                    emi: 0,
                    recharge: 0,
                    travel: 0,
                    food: 0,
                    health: 0,
                    dress: 0,
                    family: 0
                };
                
                expenses.forEach(expense => {
                    totals.emi += expense.emi;
                    totals.recharge += expense.recharge;
                    totals.travel += expense.travel;
                    totals.food += expense.food;
                    totals.health += expense.health;
                    totals.dress += expense.dress;
                    totals.family += expense.family;
                });
                
                expenseChart.data.datasets[0].data = [
                    totals.emi,
                    totals.recharge,
                    totals.travel,
                    totals.food,
                    totals.health,
                    totals.dress,
                    totals.family
                ];
                
                expenseChart.update();
                
                // Update category breakdown
                const breakdown = document.getElementById('category-breakdown');
                breakdown.innerHTML = '';
                
                const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#FF6384'];
                let colorIndex = 0;
                
                for (const category in totals) {
                    if (totals[category] > 0) {
                        const item = document.createElement('div');
                        item.className = 'distribution-item';
                        
                        item.innerHTML = `
                            <div class="category">
                                <div class="category-color" style="background-color: ${colors[colorIndex]}"></div>
                                <div>${category.charAt(0).toUpperCase() + category.slice(1)}</div>
                            </div>
                            <div>₹${totals[category].toFixed(2)}</div>
                        `;
                        
                        breakdown.appendChild(item);
                        colorIndex = (colorIndex + 1) % colors.length;
                    }
                }
                
                // Update recent expenses
                const recentExpenses = document.getElementById('recent-expenses');
                recentExpenses.innerHTML = '';
                
                // Show last 5 expenses
                const recent = expenses.slice(-5).reverse();
                
                recent.forEach(expense => {
                    const total = expense.emi + expense.recharge + expense.travel + 
                                 expense.food + expense.health + expense.dress + expense.family;
                    
                    const item = document.createElement('div');
                    item.className = 'distribution-item';
                    
                    item.innerHTML = `
                        <div>${expense.date} (${expense.day})</div>
                        <div>₹${total.toFixed(2)}</div>
                    `;
                    
                    recentExpenses.appendChild(item);
                });
            }
            
            // Update summary cards
            function updateSummary() {
                let totalIncome = 0;
                const currentMonth = months[today.getMonth()];
                
                // Get current month's salary
                if (salaryData[currentMonth]) {
                    totalIncome = salaryData[currentMonth];
                }
                
                let totalExpenses = 0;
                
                expenses.forEach(expense => {
                    totalExpenses += expense.emi + expense.recharge + expense.travel + 
                                    expense.food + expense.health + expense.dress + expense.family;
                });
                
                const balance = totalIncome - totalExpenses;
                const savings = balance > 0 ? balance : 0;
                
                document.querySelector('.income .amount').textContent = `₹${totalIncome.toFixed(2)}`;
                document.querySelector('.expense .amount').textContent = `₹${totalExpenses.toFixed(2)}`;
                document.querySelector('.balance .amount').textContent = `₹${balance.toFixed(2)}`;
                document.querySelector('.savings .amount').textContent = `₹${savings.toFixed(2)}`;
            }
            
            // Update savings goal progress
            function updateSavingsGoalProgress() {
                const balance = parseFloat(document.querySelector('.balance .amount').textContent.replace('₹', ''));
                let progress = 0;
                
                if (savingsGoal > 0) {
                    progress = Math.min(100, (balance / savingsGoal) * 100);
                }
                
                document.querySelector('.progress').style.width = `${progress}%`;
                document.querySelector('.progress').textContent = `${progress.toFixed(1)}%`;
                
                // Update savings goal input value
                document.getElementById('savings-goal').value = savingsGoal;
            }
            
            // Update savings chart
            function updateSavingsChart() {
                const labels = [];
                const data = [];
                
                for (const month in salaryData) {
                    labels.push(month);
                    
                    // Calculate savings for this month (simplified)
                    const monthlyExpenses = expenses.reduce((total, expense) => {
                        // Simple approach - in a real app, you would filter by month
                        return total + expense.emi + expense.recharge + expense.travel + 
                               expense.food + expense.health + expense.dress + expense.family;
                    }, 0);
                    
                    const savings = salaryData[month] - monthlyExpenses;
                    data.push(savings > 0 ? savings : 0);
                }
                
                savingsChart.data.labels = labels;
                savingsChart.data.datasets[0].data = data;
                savingsChart.update();
                
                // Update savings timeline
                const timeline = document.getElementById('savings-timeline');
                timeline.innerHTML = '';
                
                for (const month in salaryData) {
                    const monthlyExpenses = expenses.reduce((total, expense) => {
                        return total + expense.emi + expense.recharge + expense.travel + 
                               expense.food + expense.health + expense.dress + expense.family;
                    }, 0);
                    
                    const savings = salaryData[month] - monthlyExpenses;
                    
                    const item = document.createElement('div');
                    item.className = 'timeline-item';
                    
                    item.innerHTML = `
                        <div>${month}</div>
                        <div class="${savings >= 0 ? 'positive' : 'negative'}">₹${savings.toFixed(2)}</div>
                    `;
                    
                    timeline.appendChild(item);
                }
            }
            
            // Export salary data to Excel
            document.getElementById('export-salary-btn').addEventListener('click', function() {
                const data = [];
                
                // Add headers
                data.push(['Month', 'Salary (₹)']);
                
                // Add salary data
                for (const month in salaryData) {
                    data.push([month, salaryData[month]]);
                }
                
                // Create worksheet
                const ws = XLSX.utils.aoa_to_sheet(data);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Salary Data');
                
                // Export to Excel
                XLSX.writeFile(wb, 'salary_data.xlsx');
            });
            
            // Export expense data to Excel
            document.getElementById('export-expense-btn').addEventListener('click', function() {
                const data = [];
                
                // Add headers
                data.push(['Date', 'Day', 'EMI (₹)', 'Recharge (₹)', 'Travel (₹)', 'Food (₹)', 'Health (₹)', 'Dress (₹)', 'Family (₹)', 'Total (₹)']);
                
                // Add expense data
                expenses.forEach(expense => {
                    const total = expense.emi + expense.recharge + expense.travel + 
                                 expense.food + expense.health + expense.dress + expense.family;
                    
                    data.push([
                        expense.date,
                        expense.day,
                        expense.emi,
                        expense.recharge,
                        expense.travel,
                        expense.food,
                        expense.health,
                        expense.dress,
                        expense.family,
                        total
                    ]);
                });
                
                // Create worksheet
                const ws = XLSX.utils.aoa_to_sheet(data);
                
                // Create workbook
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Expense Data');
                
                // Export to Excel
                XLSX.writeFile(wb, 'expense_data.xlsx');
            });
            
            // Change chart type
            document.querySelectorAll('.chart-type-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Remove active class from all buttons
                    document.querySelectorAll('.chart-type-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    this.classList.add('active');
                    
                    // Change chart type
                    const chartType = this.getAttribute('data-chart-type');
                    expenseChart.destroy();
                    
                    expenseChart = new Chart(ctx, {
                        type: chartType,
                        data: {
                            labels: ['EMI', 'Recharge', 'Travel', 'Food', 'Health', 'Dress', 'Family'],
                            datasets: [{
                                data: expenseChart.data.datasets[0].data,
                                backgroundColor: [
                                    '#FF6384',
                                    '#36A2EB',
                                    '#FFCE56',
                                    '#4BC0C0',
                                    '#9966FF',
                                    '#FF9F40',
                                    '#FF6384'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        boxWidth: 15,
                                        font: {
                                            size: 11
                                        }
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Expense Distribution',
                                    font: {
                                        size: 16
                                    }
                                }
                            }
                        }
                    });
                });
            });
            
            // Toggle dark mode
            document.getElementById('theme-toggle').addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                
                const icon = this.querySelector('i');
                if (document.body.classList.contains('dark-mode')) {
                    icon.classList.remove('fa-moon');
                    icon.classList.add('fa-sun');
                    localStorage.setItem('darkMode', 'enabled');
                } else {
                    icon.classList.remove('fa-sun');
                    icon.classList.add('fa-moon');
                    localStorage.setItem('darkMode', 'disabled');
                }
            });
            
            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                const icon = document.querySelector('.theme-toggle i');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            }
            
            // Initialize the app
            renderExpenses();
            updateChart();
            updateSummary();
            updateSavingsGoalProgress();
            updateSavingsChart();
        });
    </script>
</body>
</html>